<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Dash - An introduction</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Plotly's Dash</h1>
					<h3>An introduction</h3>
					<p>
						<small>DataWorkz - Maarten van Duren</small>
					</p>
				</section>

				<section>
					<a target="_blank" href="http://127.0.0.1:8050/">
						<img src="images/screenshot01.png">
					</a>
					<p><small>Copyright (c) 2017 Plotly - MIT Licence - <a target="_blank" href="https://github.com/plotly/dash-stock-tickers-demo-app">github.com/plotly/dash-stock-tickers-demo-app</a></small></p>
				</section>

				<section>
					<h2>About Dash</h2>
					<ul>
						<li>Prototype started 2015</li>
						<li>Released in June 2017</li>
						<li><q cite="https://medium.com/@plotlygraphs/introducing-dash-5ecf7191b503">Dash is [...] for creating reactive, Web-based applications.</q></li>
						<li>Python</li>
						<li>Flask</li>
						<li>Plotly</li>
						<li>React.js</li>
						<li>Open source</li>
						<li>Enterprise tools</li>
					</ul>
				</section>

				<section>
					<h2>About Dash</h2>
					<q cite="https://medium.com/@plotlygraphs/introducing-dash-5ecf7191b503">Dash is a user interface library for creating analytical web applications. Those who use Python for data analysis, data exploration, visualization, modelling, instrument control, and reporting will find immediate use for Dash.</q>
				</section>

				<!-- graph -->

				<section>
					<h2>Graph</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import pandas as pd


df = pd.read_csv('stock-ticker.csv')
df = df[df['Stock'] == 'AAPL']

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H1('Finance Explorer'),
    dcc.Graph(
        figure={
            'data': [go.Scatter(
                x=df['Date'],
                y=df['Close'],
            )],
        })
])

if __name__ == '__main__':
    app.run_server(port=8052)
					</code></pre>
				</section>

				<section>
					<a target="_blank" href="http://127.0.0.1:8052/">
						<img src="images/screenshot02.png">
					</a>
				</section>

				<!-- remove mode bar buttons -->

				<section>
					<h2>Mode Bar buttons</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import pandas as pd


df = pd.read_csv('stock-ticker.csv')
df = df[df['Stock'] == 'AAPL']

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H1('Finance Explorer'),
    dcc.Graph(
        config=plotly_config,
        figure={
            'data': [go.Scatter(
                x=df['Date'],
                y=df['Close'],
            )],
        })
])

if __name__ == '__main__':
    app.run_server(port=8053)
					</code></pre>
				</section>

				<section>
					<a target="_blank" href="http://127.0.0.1:8053/">
						<img src="images/screenshot03.png">
					</a>
				</section>

				<!-- callback -->

				<section>
					<h2>Callback</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H1('Finance Explorer'),
    dcc.Dropdown(
        id='stock_ticker_input',
        options=[{'label': s, 'value': s}
            for s in df['Stock'].unique()],
    ),
    html.Div(id='graph_container')
])

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')])
def stock_ticker_dropdown_changed(stock_ticker):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [go.Scatter(
                x=df_ticker['Date'],
                y=df_ticker['Close'],
            )],
        })

if __name__ == '__main__':
    app.run_server(port=8054)
					</code></pre>
				</section>

				<section>
					<a target="_blank" href="http://127.0.0.1:8054/">
						<img src="images/screenshot04.png">
					</a>
				</section>

				<!-- callback with state -->

				<section>
					<h2>Callback State</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__)

app.layout = html.Div([
    html.H1('Finance Explorer'),
    dcc.Dropdown(
        id='stock_ticker_input',
        options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
    ),
    dcc.Checklist(
        id='graph_options',
        options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
        values=[]
    ),
    html.Div(id='graph_container')
])

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
        })

if __name__ == '__main__':
    app.run_server(port=8055)
					</code></pre>
				</section>
	
				<section>
					<a target="_blank" href="http://127.0.0.1:8055/">
						<img src="images/screenshot05.png">
					</a>
				</section>

				<!-- loading behaviour -->

				<section>
						<h2>Loading behaviour & custom CSS (1/2)</h2>
						<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Dropdown(
        id='stock_ticker_input',
        options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
    ),
    dcc.Checklist(
        id='graph_options',
        options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
        values=[]
    ),
    html.Div(id='graph_container')
])

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    time.sleep(3) # Just to demonstrate
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
        })

if __name__ == '__main__':
    app.run_server(port=8056)
					</code></pre>
				</section>

				<section>
						<h2>Loading behaviour & custom CSS (2/2)</h2>
						<pre class="stretch"><code class="css" data-trim contenteditable>
._dash-loading-callback {
    font-family: sans-serif;
    padding-top: 50px;
    color: rgb(90, 90, 90);
    
    -webkit-animation: fadein 0.5s ease-in 7s forwards; /* Safari, Chrome and Opera > 12.1 */
        -moz-animation: fadein 0.5s; /* Firefox < 16 */
        -ms-animation: fadein 0.5s; /* Internet Explorer */
            -o-animation: fadein 0.5s; /* Opera < 12.1 */
            animation: fadein 0.5s ease-in 7s forwards;  


    /* The banner */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.5);
    text-align: center;
    cursor: progress;
}


@keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Internet Explorer */
@-ms-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}
						</code></pre>
						<small><a target="_blank" href="https://community.plot.ly/t/mega-dash-loading-states/5687">community.plot.ly/t/mega-dash-loading-states/5687</a></small>
				</section>

				<section>
					<a target="_blank" href="http://127.0.0.1:8056/">
						<img src="images/screenshot06.png">
					</a>
				</section>

				<!-- tab -->

				<section>
					<h2>Tabs</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.P('TODO')
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
        })

if __name__ == '__main__':
    app.run_server(port=8057)
					</code></pre>
				</section>

				<section>
					<h2>Tabs</h2>
					<pre class="stretch"><code class="bash" data-trim contenteditable>
$ python app.py
...
dash.exceptions.NonExistantIdException:
Attempting to assign a callback to the
component with the id "graph_container" but no
components with id "graph_container" exist in the
app's layout.


Here is a list of IDs in layout:
['tabs', 'tab_container']


If you are assigning callbacks to components
that are generated by other callbacks
(and therefore not in the initial layout), then
you can suppress this exception by setting
`app.config['suppress_callback_exceptions']=True`.
					</code></pre>
				</section>

				<section>
					<h2>Tabs</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')
app.config['suppress_callback_exceptions'] = True

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.P('TODO')
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
        })

if __name__ == '__main__':
    app.run_server(port=8057)
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8057/">
						<img src="images/screenshot07.png">
					</a>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8057/">
						<img src="images/screenshot07a.png">
					</a>
				</section>

				<!-- parameterized callbacks / pages -->

				<section>
					<h2>URL Callbacks</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')
app.config['suppress_callback_exceptions'] = True

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.Div([
            dcc.Location(id='url', refresh=False),
            html.Div(id='annotations_container', children=[annotations_container()])
        ])
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
        })

df_annotations = pd.DataFrame([
    {'id': 1, 'Ticker': 'AAPL', 'Date': '2016-04-01', 'Text': 'Bought 100 shares'},
    {'id': 2, 'Ticker': 'AAPL', 'Date': '2016-09-16', 'Text': 'Sold 68 shares'},
    {'id': 3, 'Ticker': 'TSLA', 'Date': '2016-09-24', 'Text': 'Bought 100 shares'},
    {'id': 4, 'Ticker': 'TSLA', 'Date': '2016-10-08', 'Text': 'Bought 20 shares'},
    {'id': 5, 'Ticker': 'TSLA', 'Date': '2017-01-25', 'Text': 'Sold 70 shares'}])

def annotations_container():
    global df_annotations
    return html.Div([
        html.Table(
            [html.Tr([html.Th(col) for col in ['Ticker', 'Date', 'Text', '']])] +
            [html.Tr([
                html.Td(row['Ticker']), html.Td(row['Date']), html.Td(row['Text']),
                html.Td(dcc.Link('Delete', href='/annotations/delete/' + str(row['id'])))
            ]) for _, row in df_annotations.iterrows()] +
            [html.Tr([
                html.Td([dcc.Input(id='annotation_ticker')]),
                html.Td([dcc.Input(id='annotation_date')]),
                html.Td([dcc.Input(id='annotation_text')]),
                html.Td([dcc.Link('Insert', href='/annotations/insert')]),
            ])]
        )
    ])

@app.callback(Output('annotations_container', 'children'),
    [Input('url', 'pathname')],
    [State('annotation_ticker', 'value'),
        State('annotation_date', 'value'),
        State('annotation_text', 'value')])
def annotations_container_action(path, annotation_ticker, annotation_date, annotation_text):
    global df_annotations
    if path.startswith('/annotations/delete/'):
        id_to_delete = int(path[20:])
        df_annotations = df_annotations[df_annotations['id'] != id_to_delete]
    if path.startswith('/annotations/insert'):
        df_annotations = df_annotations.append(
            {'id': int(max(df_annotations['id'])+1),
             'Ticker': annotation_ticker,
             'Date': annotation_date,
             'Text': annotation_text},
            ignore_index=True)
    return annotations_container()


if __name__ == '__main__':
    app.run_server(port=8058)
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8058/">
						<img src="images/screenshot08.png">
					</a>
				</section>

				<section>
					<h2>Annotations</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')
app.config['suppress_callback_exceptions'] = True

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.Div([
            dcc.Location(id='url', refresh=False),
            html.Div(id='annotations_container', children=[annotations_container()])
        ])
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    global df_annotations
    df_ticker = df[df['Stock'] == stock_ticker]
    return dcc.Graph(
        config=plotly_config,
        figure={
            'data': [
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Close'],
                    name='Close',
                    ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['High'],
                    name='High',
                    visible='with_high' in graph_options
                ),
                go.Scatter(
                    x=df_ticker['Date'],
                    y=df_ticker['Low'],
                    name='Low',
                    visible='with_low' in graph_options
                ),
            ],
            'layout': {
                'annotations': [
                    {'text': annotation['Text'],
                        'x': annotation['Date'],
                        'y': df_ticker[df_ticker['Date'] == annotation['Date']]['Close'].values[0],
                        'showarrow': 'true'}
                    for _, annotation in df_annotations.iterrows()
                    if annotation['Ticker'] == stock_ticker
                ]
            }
        })

df_annotations = pd.DataFrame([
    {'id': 1, 'Ticker': 'AAPL', 'Date': '2016-04-01', 'Text': 'Bought 100 shares'},
    {'id': 2, 'Ticker': 'AAPL', 'Date': '2016-09-16', 'Text': 'Sold 68 shares'},
    {'id': 3, 'Ticker': 'TSLA', 'Date': '2016-09-23', 'Text': 'Bought 100 shares'},
    {'id': 4, 'Ticker': 'TSLA', 'Date': '2016-10-07', 'Text': 'Bought 20 shares'},
    {'id': 5, 'Ticker': 'TSLA', 'Date': '2017-01-25', 'Text': 'Sold 70 shares'}])

def annotations_container():
    global df_annotations
    return html.Div([
        html.Table(
            [html.Tr([html.Th(col) for col in ['Ticker', 'Date', 'Text', '']])] +
            [html.Tr([
                html.Td(row['Ticker']), html.Td(row['Date']), html.Td(row['Text']),
                html.Td(dcc.Link('Delete', href='/annotations/delete/' + str(row['id'])))
            ]) for _, row in df_annotations.iterrows()] +
            [html.Tr([
                html.Td([dcc.Input(id='annotation_ticker')]),
                html.Td([dcc.Input(id='annotation_date')]),
                html.Td([dcc.Input(id='annotation_text')]),
                html.Td([dcc.Link('Insert', href='/annotations/insert')]),
            ])]
        )
    ])

@app.callback(Output('annotations_container', 'children'),
    [Input('url', 'pathname')],
    [State('annotation_ticker', 'value'),
     State('annotation_date', 'value'),
     State('annotation_text', 'value')])
def annotations_container_action(path, annotation_ticker, annotation_date, annotation_text):
    global df_annotations
    if path.startswith('/annotations/delete/'):
        id_to_delete = int(path[20:])
        df_annotations = df_annotations[df_annotations['id'] != id_to_delete]
    if path.startswith('/annotations/insert'):
        df_annotations = df_annotations.append(
            {'id': int(max(df_annotations['id'])+1),
             'Ticker': annotation_ticker,
             'Date': annotation_date,
             'Text': annotation_text},
            ignore_index=True)
    return annotations_container()


if __name__ == '__main__':
    app.run_server(port=8058)
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8058/">
						<img src="images/screenshot08a.png">
					</a>
				</section>
				
				<!-- custom javascript -->

				<section>
					<h2>Custom JavaScript</h2>
					<pre class="stretch"><code class="javascript" data-trim contenteditable>
function clear_url() {
    if (window.location.pathname.startsWith('/annotations')) {
        window.history.pushState('', '', '/');
    }
}

function callback(e) {
    var e = window.e || e;

    if (e.target.tagName !== 'A')
        return;

    clear_url()
}

if (document.addEventListener)
    document.addEventListener('click', callback, false);
else
    document.attachEvent('onclick', callback);

document.body.addEventListener('DOMSubtreeModified', function() {
    clear_url()
}, false);
					</code></pre>
				</section>

				<section>
					<h2>Custom JavaScript</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
...

app = dash.Dash(__name__, static_folder='assets')

...
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8059/">
						<img src="images/screenshot09.png">
					</a>
				</section>
				
				<!-- cross select -->

				<section>
					<h2>Cross select</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

# Source: https://fred.stlouisfed.org/series/DEXUSEU
df_eurusd = pd.read_csv('DEXUSEU.csv')
df_eurusd.columns = ['Date', 'USD_EUR']

# Source: https://fred.stlouisfed.org/series/NASDAQCOM
df_nasdaq = pd.read_csv('NASDAQCOM.csv')
df_nasdaq.columns = ['Date', 'Nasdaq']

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')
app.config['suppress_callback_exceptions'] = True

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.Div([
            dcc.Location(id='url', refresh=False),
            html.Div(id='annotations_container', children=[annotations_container()])
        ])
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    global df_annotations
    df_ticker = df[df['Stock'] == stock_ticker]
    df_ticker = pd.merge(df_ticker, df_eurusd, how='inner', on='Date', sort=False)
    df_ticker = pd.merge(df_ticker, df_nasdaq, how='inner', on='Date', sort=False)
    return html.Div([
        html.Div([dcc.Graph(
            id='graph1',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        x=df_ticker['Date'],
                        y=df_ticker['Close'],
                        name='Close',
                        ),
                    go.Scatter(
                        x=df_ticker['Date'],
                        y=df_ticker['High'],
                        name='High',
                        visible='with_high' in graph_options
                    ),
                    go.Scatter(
                        x=df_ticker['Date'],
                        y=df_ticker['Low'],
                        name='Low',
                        visible='with_low' in graph_options
                    ),
                ],
                'layout': {
                    'annotations': [
                        {'text': annotation['Text'],
                         'x': annotation['Date'],
                         'y': df_ticker[df_ticker['Date'] == annotation['Date']]['Close'].values[0],
                         'showarrow': 'true'}
                        for _, annotation in df_annotations.iterrows()
                        if annotation['Ticker'] == stock_ticker
                    ]
                }
            })],
            style={'width': '100%', 'display': 'inline-block', 'vertical-align': 'top'}),
        html.Div([dcc.Graph(
            id='graph2',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        mode='markers',
                        x=df_ticker['Close'],
                        y=df_ticker['USD_EUR'],
                        name='USD EUR')
                ],
                'layout': {'title': 'USD / EUR'}})],
            style={'width': '50%', 'display': 'inline-block', 'vertical-align': 'top'}),
        html.Div([dcc.Graph(
            id='graph3',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        mode='markers',
                        x=df_ticker['Close'],
                        y=df_ticker['Nasdaq'],
                        name='Nasdaq')
                ],
                'layout': {'title': 'Nasdaq'}})],
            style={'width': '50%', 'display': 'inline-block', 'vertical-align': 'top'}),
    ])

df_annotations = pd.DataFrame([
    {'id': 1, 'Ticker': 'AAPL', 'Date': '2016-04-01', 'Text': 'Bought 100 shares'},
    {'id': 2, 'Ticker': 'AAPL', 'Date': '2016-09-16', 'Text': 'Sold 68 shares'},
    {'id': 3, 'Ticker': 'TSLA', 'Date': '2016-09-23', 'Text': 'Bought 100 shares'},
    {'id': 4, 'Ticker': 'TSLA', 'Date': '2016-10-07', 'Text': 'Bought 20 shares'},
    {'id': 5, 'Ticker': 'TSLA', 'Date': '2017-01-25', 'Text': 'Sold 70 shares'}])

def annotations_container():
    global df_annotations
    return html.Div([
        html.Table(
            [html.Tr([html.Th(col) for col in ['Ticker', 'Date', 'Text', '']])] +
            [html.Tr([
                html.Td(row['Ticker']), html.Td(row['Date']), html.Td(row['Text']),
                html.Td(dcc.Link('Delete', href='/annotations/delete/' + str(row['id'])))
            ]) for _, row in df_annotations.iterrows()] +
            [html.Tr([
                html.Td([dcc.Input(id='annotation_ticker')]),
                html.Td([dcc.Input(id='annotation_date')]),
                html.Td([dcc.Input(id='annotation_text')]),
                html.Td([dcc.Link('Insert', href='/annotations/insert')]),
            ])]
        )
    ])

@app.callback(Output('annotations_container', 'children'),
    [Input('url', 'pathname')],
    [State('annotation_ticker', 'value'),
     State('annotation_date', 'value'),
     State('annotation_text', 'value')])
def annotations_container_action(path, annotation_ticker, annotation_date, annotation_text):
    global df_annotations
    if path.startswith('/annotations/delete/'):
        id_to_delete = int(path[20:])
        df_annotations = df_annotations[df_annotations['id'] != id_to_delete]
    if path.startswith('/annotations/insert'):
        df_annotations = df_annotations.append(
            {'id': int(max(df_annotations['id'])+1),
             'Ticker': annotation_ticker,
             'Date': annotation_date,
             'Text': annotation_text},
            ignore_index=True)
    return annotations_container()


if __name__ == '__main__':
    app.run_server(port=8060)
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8060/">
						<img src="images/screenshot10.png">
					</a>
				</section>

				<section>
					<h2>Cross select</h2>
					<pre class="stretch"><code class="python" data-trim contenteditable>
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import plotly.graph_objs as go

import os
import pandas as pd
import time


df = pd.read_csv('stock-ticker.csv')

# Source: https://fred.stlouisfed.org/series/DEXUSEU
df_eurusd = pd.read_csv('DEXUSEU.csv')
df_eurusd.columns = ['Date', 'USD_EUR']

# Source: https://fred.stlouisfed.org/series/NASDAQCOM
df_nasdaq = pd.read_csv('NASDAQCOM.csv')
df_nasdaq.columns = ['Date', 'Nasdaq']

plotly_config = {
    'showLink': False,
    'displayModeBar': True,
    'displaylogo': False,
    'scrollZoom': True,
    'modeBarButtonsToRemove': ['sendDataToCloud']
}

app = dash.Dash(__name__, static_folder='assets')
app.config['suppress_callback_exceptions'] = True

app.layout = html.Div([
    html.Link(href='/assets/loading_callback.css', rel='stylesheet'),
    html.H1('Finance Explorer'),
    dcc.Tabs(id='tabs',
        children=[dcc.Tab(label='Annotations', value='Annotations'),
                  dcc.Tab(label='Stocks', value='Stocks')]),
    html.Div(id='tab_container')
])

@app.callback(Output('tab_container', 'children'),
    [Input('tabs', 'value')])
def tabs_changed(selected_tab):
    if selected_tab == 'Annotations':
        return html.Div([
            dcc.Location(id='url', refresh=False),
            html.Div(id='annotations_container', children=[annotations_container()])
        ])
    elif selected_tab == 'Stocks':
        return html.Div([
            dcc.Dropdown(
                id='stock_ticker_input',
                options=[{'label': s, 'value': s} for s in df['Stock'].unique()],
            ),
            dcc.Checklist(
                id='graph_options',
                options=[{'label': 'With daily high', 'value': 'with_high'}, {'label': 'With daily low', 'value': 'with_low'}],
                values=[]
            ),
            html.Div(id='graph_container')
        ])
    else:
        return html.P('Something went wrong :(')

@app.callback(Output('graph_container', 'children'),
    [Input('stock_ticker_input', 'value')],
    [State('graph_options', 'values')])
def stock_ticker_dropdown_changed(stock_ticker, graph_options):
    if stock_ticker not in df['Stock'].unique():
        return html.P('Select valid stock ticker from the dropdown...')
    global df_annotations
    df_ticker = df[df['Stock'] == stock_ticker]
    df_ticker = pd.merge(df_ticker, df_eurusd, how='inner', on='Date', sort=False)
    df_ticker = pd.merge(df_ticker, df_nasdaq, how='inner', on='Date', sort=False)
    return html.Div([
        html.Div([dcc.Graph(
            id='graph0',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        mode='markers+lines',
                        x=df_ticker['Date'],
                        y=df_ticker['Close'],
                        name='Close',
                        text=df_ticker['Date']
                    ),
                    go.Scatter(
                        x=df_ticker['Date'],
                        y=df_ticker['High'],
                        name='High',
                        visible='with_high' in graph_options
                    ),
                    go.Scatter(
                        x=df_ticker['Date'],
                        y=df_ticker['Low'],
                        name='Low',
                        visible='with_low' in graph_options
                    ),
                ],
                'layout': {
                    'annotations': [
                        {'text': annotation['Text'],
                         'x': annotation['Date'],
                         'y': df_ticker[df_ticker['Date'] == annotation['Date']]['Close'].values[0],
                         'showarrow': 'true'}
                        for _, annotation in df_annotations.iterrows()
                        if annotation['Ticker'] == stock_ticker
                    ]
                }
            })],
            style={'width': '100%', 'display': 'inline-block', 'vertical-align': 'top'}),
        html.Div([dcc.Graph(
            id='graph1',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        mode='markers',
                        x=df_ticker['Close'],
                        y=df_ticker['USD_EUR'],
                        name='USD EUR',
                        text=df_ticker['Date'])
                ],
                'layout': {'title': 'USD / EUR'}})],
            style={'width': '50%', 'display': 'inline-block', 'vertical-align': 'top'}),
        html.Div([dcc.Graph(
            id='graph2',
            config=plotly_config,
            figure={
                'data': [
                    go.Scatter(
                        mode='markers',
                        x=df_ticker['Close'],
                        y=df_ticker['Nasdaq'],
                        name='Nasdaq',
                        text=df_ticker['Date'])
                ],
                'layout': {'title': 'Nasdaq'}})],
            style={'width': '50%', 'display': 'inline-block', 'vertical-align': 'top'}),
    ])

df_annotations = pd.DataFrame([
    {'id': 1, 'Ticker': 'AAPL', 'Date': '2016-04-01', 'Text': 'Bought 100 shares'},
    {'id': 2, 'Ticker': 'AAPL', 'Date': '2016-09-16', 'Text': 'Sold 68 shares'},
    {'id': 3, 'Ticker': 'TSLA', 'Date': '2016-09-23', 'Text': 'Bought 100 shares'},
    {'id': 4, 'Ticker': 'TSLA', 'Date': '2016-10-07', 'Text': 'Bought 20 shares'},
    {'id': 5, 'Ticker': 'TSLA', 'Date': '2017-01-25', 'Text': 'Sold 70 shares'}])

def annotations_container():
    global df_annotations
    return html.Div([
        html.Table(
            [html.Tr([html.Th(col) for col in ['Ticker', 'Date', 'Text', '']])] +
            [html.Tr([
                html.Td(row['Ticker']), html.Td(row['Date']), html.Td(row['Text']),
                html.Td(dcc.Link('Delete', href='/annotations/delete/' + str(row['id'])))
            ]) for _, row in df_annotations.iterrows()] +
            [html.Tr([
                html.Td([dcc.Input(id='annotation_ticker')]),
                html.Td([dcc.Input(id='annotation_date')]),
                html.Td([dcc.Input(id='annotation_text')]),
                html.Td([dcc.Link('Insert', href='/annotations/insert')]),
            ])]
        )
    ])

@app.callback(Output('annotations_container', 'children'),
    [Input('url', 'pathname')],
    [State('annotation_ticker', 'value'),
     State('annotation_date', 'value'),
     State('annotation_text', 'value')])
def annotations_container_action(path, annotation_ticker, annotation_date, annotation_text):
    global df_annotations
    if path.startswith('/annotations/delete/'):
        id_to_delete = int(path[20:])
        df_annotations = df_annotations[df_annotations['id'] != id_to_delete]
    if path.startswith('/annotations/insert'):
        df_annotations = df_annotations.append(
            {'id': int(max(df_annotations['id'])+1),
             'Ticker': annotation_ticker,
             'Date': annotation_date,
             'Text': annotation_text},
            ignore_index=True)
    return annotations_container()


if __name__ == '__main__':
    app.run_server(port=8061)
					</code></pre>
				</section>

				<section>
					<h2>Cross select</h2>
					<pre class="stretch"><code class="javascript" data-trim contenteditable>
var listeners_set = false;
new MutationObserver(function(m) {
    if (!listeners_set) {
        n_graphs = 3;
        for (var i=0; i < n_graphs; i++) {
            var element = document.getElementById("graph" + i);
            if (element) {
                element.on("plotly_selected", function(event_data) {
                    var selected_data = []
                    for (var j=0; j < event_data.points.length; j++) {
                        selected_data.push(event_data.points[j].text);
                    }
                    for (var k=0; k < n_graphs; k++) {
                        var element2 = document.getElementById("graph" + k);
                        if (element2) {
                            var opacities = [];
                            for (var l=0; l < element2.data[0].text.length; l++) {
                                if (selected_data.indexOf(element2.data[0].text[l]) > -1) {
                                    opacities.push(1.0);
                                } else {
                                    opacities.push(0.2);
                                }
                            }
                            Plotly.restyle(element2, {
                                selectedpoints: [null],
                                "selected.marker.opacity": 1.0,
                                'unselected.marker.opacity': 0.2,
                                'marker.opacity': [opacities]
                            })
                        }
                    }
                })
                listeners_set = true
            }
        }
    }
}).observe(document.documentElement, {childList: true, subtree: true});

document.addEventListener('DOMSubtreeModified', function() {
    if (listeners_set && document.querySelectorAll("div.tab--selected")[0].innerText != "Stocks") {
        listeners_set = false;
    }
}, false);
					</code></pre>
				</section>
		
				<section>
					<a target="_blank" href="http://127.0.0.1:8061/">
						<img src="images/screenshot11.png">
					</a>
				</section>

				<!-- take aways -->

				<section>
					<h2>Take aways</h2>
					<ul>
						<li><a target="_blank" href="https://plot.ly/products/dash/">plot.ly/products/dash/</a></li>
						<li><a target="_blank" href="https://github.com/MaartenVanDuren">github.com/MaartenVanDuren</a></li>
						<li><a target="_blank" href="http://meetup.com/nl-NL/DataWorkz/">Meetup.com/nl-NL/DataWorkz</a></li>
						<li><a target="_blank" href="http://www.dataworkz.nl">DataWorkz.nl</a></li>
						<li><a target="_blank" href="http://www.skyworkz.nl">SkyWorkz.nl</a></li>
						<li><a target="_blank" href="http://www.linkedin.com/in/maartenvanduren">LinkedIn: Maarten van Duren</a></li>
					</ul>
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
